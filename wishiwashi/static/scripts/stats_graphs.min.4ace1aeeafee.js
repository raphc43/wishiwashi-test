(function(){function e(e){d3.select("#placed_chart svg").remove();var t={top:40,right:20,bottom:30,left:40},n=1150-t.left-t.right,r=400-t.top-t.bottom,i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.linear().range([r,0]),o=d3.svg.axis().scale(i).orient("bottom"),u=d3.svg.axis().scale(s).orient("left").ticks(5),a=function(e){return e.frequency=+e.frequency,e},f=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>Orders:</strong> <span style='color:red'>"+e.frequency+"</span>"}),l=d3.select("#placed_chart").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");l.call(f),d3.tsv(e,a,function(e,t){i.domain(t.map(function(e){return e.day})),s.domain([0,d3.max(t,function(e){return e.frequency})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),l.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),l.selectAll(".bar").data(t).enter().append("rect").attr("class","bar-placed").attr("x",function(e){return i(e.day)}).attr("width",i.rangeBand()).attr("y",function(e){return s(e.frequency)}).attr("height",function(e){return r-s(e.frequency)}).on("mouseover",f.show).on("mouseout",f.hide)})}function t(e){d3.select("#placed_chart_yearly svg").remove();var t={top:40,right:20,bottom:30,left:40},n=1150-t.left-t.right,r=400-t.top-t.bottom,i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.linear().range([r,0]),o=d3.svg.axis().scale(i).orient("bottom"),u=d3.svg.axis().scale(s).orient("left").ticks(5),a=function(e){return e.frequency=+e.frequency,e},f=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>Orders:</strong> <span style='color:red'>"+e.frequency+"</span>"}),l=d3.select("#placed_chart_yearly").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");l.call(f),d3.tsv(e,a,function(e,t){i.domain(t.map(function(e){return e.month})),s.domain([0,d3.max(t,function(e){return e.frequency})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),l.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),l.selectAll(".bar").data(t).enter().append("rect").attr("class","bar-placed").attr("x",function(e){return i(e.month)}).attr("width",i.rangeBand()).attr("y",function(e){return s(e.frequency)}).attr("height",function(e){return r-s(e.frequency)}).on("mouseover",f.show).on("mouseout",f.hide)})}function n(e){d3.select("#new_customers_chart svg").remove();var t={top:40,right:20,bottom:30,left:40},n=1150-t.left-t.right,r=400-t.top-t.bottom,i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.linear().range([r,0]),o=d3.svg.axis().scale(i).orient("bottom"),u=d3.svg.axis().scale(s).orient("left").ticks(5),a=function(e){return e.frequency=+e.frequency,e},f=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>New customers:</strong> <span style='color:red'>"+e.frequency+"</span>"}),l=d3.select("#new_customers_chart").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");l.call(f),d3.tsv(e,a,function(e,t){i.domain(t.map(function(e){return e.day})),s.domain([0,d3.max(t,function(e){return e.frequency})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),l.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),l.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(e){return i(e.day)}).attr("width",i.rangeBand()).attr("y",function(e){return s(e.frequency)}).attr("height",function(e){return r-s(e.frequency)}).on("mouseover",f.show).on("mouseout",f.hide)})}function r(e){d3.select("#new_customers_yearly_chart svg").remove();var t={top:40,right:20,bottom:30,left:40},n=1150-t.left-t.right,r=400-t.top-t.bottom,i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.linear().range([r,0]),o=d3.svg.axis().scale(i).orient("bottom"),u=d3.svg.axis().scale(s).orient("left").ticks(5),a=function(e){return e.frequency=+e.frequency,e},f=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>New customers:</strong> <span style='color:red'>"+e.frequency+"</span>"}),l=d3.select("#new_customers_yearly_chart").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");l.call(f),d3.tsv(e,a,function(e,t){i.domain(t.map(function(e){return e.month})),s.domain([0,d3.max(t,function(e){return e.frequency})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),l.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),l.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(e){return i(e.month)}).attr("width",i.rangeBand()).attr("y",function(e){return s(e.frequency)}).attr("height",function(e){return r-s(e.frequency)}).on("mouseover",f.show).on("mouseout",f.hide)})}function i(e){d3.select("#pickup_delivery_chart svg").remove();var t={top:40,right:20,bottom:30,left:40},n=1150-t.left-t.right,r=400-t.top-t.bottom,i=d3.scale.ordinal().rangeRoundBands([0,n],.1),s=d3.scale.ordinal(),o=d3.scale.linear().range([r,0]),u=d3.scale.ordinal().range(["#228B22","#8a89a6"]),a=d3.svg.axis().scale(i).orient("bottom"),f=d3.svg.axis().scale(o).orient("left").tickFormat(d3.format("1s")),l=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>"+e.name+":</strong> <span style='color:red'>"+
e.value+"</span>"}),c=d3.select("#pickup_delivery_chart").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");c.call(l),d3.tsv(e,function(e,t){if(e)throw e;var h=d3.keys(t[0]).filter(function(e){return e!=="day"});t.forEach(function(e){e.orders=h.map(function(t){return{name:t,value:+e[t]}})}),i.domain(t.map(function(e){return e.day})),s.domain(h).rangeRoundBands([0,i.rangeBand()]),o.domain([0,d3.max(t,function(e){return d3.max(e.orders,function(e){return e.value})})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(a),c.append("g").attr("class","y axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency");var p=c.selectAll(".day").data(t).enter().append("g").attr("class","day").attr("transform",function(e){return"translate("+i(e.day)+",0)"});p.selectAll("rect").data(function(e){return e.orders}).enter().append("rect").attr("width",s.rangeBand()).attr("x",function(e){return s(e.name)}).attr("y",function(e){return o(e.value)}).attr("height",function(e){return r-o(e.value)}).style("fill",function(e){return u(e.name)}).on("mouseover",l.show).on("mouseout",l.hide);var d=c.selectAll(".legend").data(h.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+t*20+")"});d.append("rect").attr("x",n-18).attr("width",18).attr("height",18).style("fill",u),d.append("text").attr("x",n-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e})})}function s(e){d3.select("#heatmap_chart svg").remove();var t={top:50,right:0,bottom:100,left:30},n=1150-t.left-t.right,r=470-t.top-t.bottom,i=Math.floor(n/24),s=120,o=9,u=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],a=["Mo","Tu","We","Th","Fr","Sa","Su"],f=["1-2","2-3","3-4","4-5","5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-19","19-20","20-12","21-22","22-23","23-24","24-"],l=d3.select("#heatmap_chart").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),c=l.selectAll(".dayLabel").data(a).enter().append("text").text(function(e){return e}).attr("x",0).attr("y",function(e,t){return t*i}).style("text-anchor","end").attr("transform","translate(-6,"+i/1.5+")").attr("class",function(e,t){return t>=0&&t<=4?"dayLabel mono axis axis-workweek":"dayLabel mono axis"}),h=l.selectAll(".timeLabel").data(f).enter().append("text").text(function(e){return e}).attr("x",function(e,t){return t*i}).attr("y",0).style("text-anchor","middle").attr("transform","translate("+i/2+", -6)").attr("class",function(e,t){return t>=7&&t<=16?"timeLabel mono axis axis-worktime":"timeLabel mono axis"}),p=function(e){d3.tsv(e,function(e){return{day:+e.day,hour:+e.hour,value:+e.value}},function(e,t){var n=d3.scale.quantile().domain([0,o-1,d3.max(t,function(e){return e.value})]).range(u),a=l.selectAll(".hour").data(t,function(e){return e.day+":"+e.hour});a.append("title"),a.enter().append("rect").attr("x",function(e){return(e.hour-1)*i}).attr("y",function(e){return(e.day-1)*i}).attr("rx",4).attr("ry",4).attr("class","hour bordered").attr("width",i).attr("height",i).style("fill",u[0]),a.transition().duration(1e3).style("fill",function(e){return n(e.value)}),a.select("title").text(function(e){return e.value}),a.exit().remove();var f=l.selectAll(".legend").data([0].concat(n.quantiles()),function(e){return e});f.enter().append("g").attr("class","legend"),f.append("rect").attr("x",function(e,t){return s*t}).attr("y",r).attr("width",s).attr("height",i/2).style("fill",function(e,t){return u[t]}),f.append("text").attr("class","mono").text(function(e){return"\u2265 "+Math.round(e)}).attr("x",function(e,t){return s*t}).attr("y",r+i),f.exit().remove()})};p(e)}function o(e,t){var n=new Date("June 2015"),r=new Date,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s='<select id = "'+t+'" class="form-control">';while(n<=r){var o=n.getMonth()==r.getMonth()&&n.getYear()==r.getYear()?'selected="selected"':"",u=i[n.getMonth()]+" "+n.getFullYear();s+="<option "+o+" value='"+e+"?month="+(n.getMonth()+1)+"&year="+n.getFullYear()+"'>"+u+"</option>",n.setMonth(n.getMonth()+1)}return s+="</select>",s}function u(e,t){var n=new Date("2015"),r=new Date,i='<select id = "'+t+'" class="form-control">';while(n<=r){var s=n.getYear()==r.getYear()?'selected="selected"':"",o=n.getFullYear();i+="<option "+s+" value='"+e+"?year="+n.getFullYear()+"'>"+o+"</option>",n.setFullYear(n.getFullYear()+1)}return i+="</select>",i}d3.select("#customers_yearly_opts").on("change",function(){var e=d3.select(this).property("value");r(e)}),d3.select("#heatmap_monthly_opts").on("change",function(){var e=d3.select(this).property("value");document.getElementById("heatmap_pickups").checked?e+="&pickups=1":e+="&pickups=",document.getElementById("heatmap_deliveries").checked?e+="&deliveries=1":e+="&deliveries=",s(e)}),d3.select("#heatmap_pickups").on("change",function(){var e=d3.select("#heatmap_monthly_opts").property("value");this.checked?e+="&pickups=1":e+="&pickups=",document.getElementById("heatmap_deliveries").checked?e+="&deliveries=1":e+="&deliveries=",s(e)}),d3.select("#heatmap_deliveries").on("change",function(){var e=d3.select("#heatmap_monthly_opts").property("value");this.checked?e+="&deliveries=1":e+="&deliveries=",document.getElementById("heatmap_pickups").checked?e+="&pickups=1":e+="&pickups=",s(e)})}).call(this);
