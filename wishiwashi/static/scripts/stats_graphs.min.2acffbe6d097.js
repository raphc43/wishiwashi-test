(function(){function e(e,t){d3.select(t+" svg").remove();var n={top:40,right:20,bottom:30,left:40},r=1150-n.left-n.right,i=400-n.top-n.bottom,s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().range([i,0]),u=d3.svg.axis().scale(s).orient("bottom"),a=d3.svg.axis().scale(o).orient("left").ticks(5),f=function(e){return e.frequency=+e.frequency,e},l=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>Orders:</strong> <span style='color:red'>"+e.frequency+"</span>"}),c=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");c.call(l),d3.tsv(e,f,function(e,t){s.domain(t.map(function(e){return e.day})),o.domain([0,d3.max(t,function(e){return e.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(u),c.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(t).enter().append("rect").attr("class","bar-placed").attr("x",function(e){return s(e.day)}).attr("width",s.rangeBand()).attr("y",function(e){return o(e.frequency)}).attr("height",function(e){return i-o(e.frequency)}).on("mouseover",l.show).on("mouseout",l.hide)})}function t(e,t){d3.select(t+" svg").remove();var n={top:40,right:20,bottom:30,left:40},r=1150-n.left-n.right,i=400-n.top-n.bottom,s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().range([i,0]),u=d3.svg.axis().scale(s).orient("bottom"),a=d3.svg.axis().scale(o).orient("left").ticks(5),f=function(e){return e.frequency=+e.frequency,e},l=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>Orders:</strong> <span style='color:red'>"+e.frequency+"</span>"}),c=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");c.call(l),d3.tsv(e,f,function(e,t){s.domain(t.map(function(e){return e.month})),o.domain([0,d3.max(t,function(e){return e.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(u),c.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(t).enter().append("rect").attr("class","bar-placed").attr("x",function(e){return s(e.month)}).attr("width",s.rangeBand()).attr("y",function(e){return o(e.frequency)}).attr("height",function(e){return i-o(e.frequency)}).on("mouseover",l.show).on("mouseout",l.hide)})}function n(e,t){d3.select(t+" svg").remove();var n={top:40,right:20,bottom:30,left:40},r=1150-n.left-n.right,i=400-n.top-n.bottom,s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().range([i,0]),u=d3.svg.axis().scale(s).orient("bottom"),a=d3.svg.axis().scale(o).orient("left").ticks(5),f=function(e){return e.frequency=+e.frequency,e},l=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>New customers:</strong> <span style='color:red'>"+e.frequency+"</span>"}),c=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");c.call(l),d3.tsv(e,f,function(e,t){s.domain(t.map(function(e){return e.day})),o.domain([0,d3.max(t,function(e){return e.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(u),c.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(e){return s(e.day)}).attr("width",s.rangeBand()).attr("y",function(e){return o(e.frequency)}).attr("height",function(e){return i-o(e.frequency)}).on("mouseover",l.show).on("mouseout",l.hide)})}function r(e,t){d3.select(t+" svg").remove();var n={top:40,right:20,bottom:30,left:40},r=1150-n.left-n.right,i=400-n.top-n.bottom,s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().range([i,0]),u=d3.svg.axis().scale(s).orient("bottom"),a=d3.svg.axis().scale(o).orient("left").ticks(5),f=function(e){return e.frequency=+e.frequency,e},l=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>New customers:</strong> <span style='color:red'>"+e.frequency+"</span>"}),c=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");c.call(l),d3.tsv(e,f,function(e,t){s.domain(t.map(function(e){return e.month})),o.domain([0,d3.max(t,function(e){return e.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(u),c.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(e){return s(e.month)}).attr("width",s.rangeBand()).attr("y",function(e){return o(e.frequency)}).attr("height",function(e){return i-o(e.frequency)}).on("mouseover",l.show).on("mouseout",l.hide)})}function i(e,t){d3.select(t+" svg").remove();var n={top:40,right:20,bottom:30,left:40},r=1150-n.left-n.right,i=400-n.top-n.bottom,s=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.ordinal(),u=d3.scale.linear().range([i,0]),a=d3.scale.ordinal().range(["#228B22","#8a89a6"]),f=d3.svg.axis().scale(s).orient("bottom"),l=d3.svg.axis().scale(u).orient("left").tickFormat(d3.format("1s")),c=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>"+e.name+":</strong> <span style='color:red'>"+e.value+"</span>"}),h=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+
n.left+","+n.top+")");h.call(c),d3.tsv(e,function(e,t){if(e)throw e;var n=d3.keys(t[0]).filter(function(e){return e!=="day"});t.forEach(function(e){e.orders=n.map(function(t){return{name:t,value:+e[t]}})}),s.domain(t.map(function(e){return e.day})),o.domain(n).rangeRoundBands([0,s.rangeBand()]),u.domain([0,d3.max(t,function(e){return d3.max(e.orders,function(e){return e.value})})]),h.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(f),h.append("g").attr("class","y axis").call(l).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Frequency");var p=h.selectAll(".day").data(t).enter().append("g").attr("class","day").attr("transform",function(e){return"translate("+s(e.day)+",0)"});p.selectAll("rect").data(function(e){return e.orders}).enter().append("rect").attr("width",o.rangeBand()).attr("x",function(e){return o(e.name)}).attr("y",function(e){return u(e.value)}).attr("height",function(e){return i-u(e.value)}).style("fill",function(e){return a(e.name)}).on("mouseover",c.show).on("mouseout",c.hide);var d=h.selectAll(".legend").data(n.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+t*20+")"});d.append("rect").attr("x",r-18).attr("width",18).attr("height",18).style("fill",a),d.append("text").attr("x",r-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e})})}function s(e,t){d3.select(t+" svg").remove();var n={top:50,right:0,bottom:100,left:30},r=1150-n.left-n.right,i=470-n.top-n.bottom,s=Math.floor(r/24),o=120,u=9,a=["#ffffff","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],f=["Mo","Tu","We","Th","Fr","Sa","Su"],l=["1-2","2-3","3-4","4-5","5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-19","19-20","20-12","21-22","22-23","23-24","24-"],c=d3.select(t).append("svg").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),h=c.selectAll(".dayLabel").data(f).enter().append("text").text(function(e){return e}).attr("x",0).attr("y",function(e,t){return t*s}).style("text-anchor","end").attr("transform","translate(-6,"+s/1.5+")").attr("class",function(e,t){return t>=0&&t<=4?"dayLabel mono axis axis-workweek":"dayLabel mono axis"}),p=c.selectAll(".timeLabel").data(l).enter().append("text").text(function(e){return e}).attr("x",function(e,t){return t*s}).attr("y",0).style("text-anchor","middle").attr("transform","translate("+s/2+", -6)").attr("class",function(e,t){return t>=7&&t<=16?"timeLabel mono axis axis-worktime":"timeLabel mono axis"}),d=function(e){d3.tsv(e,function(e){return{day:+e.day,hour:+e.hour,value:+e.value}},function(e,t){var n=d3.scale.quantile().domain([0,u-1,d3.max(t,function(e){return e.value})]).range(a),r=c.selectAll(".hour").data(t,function(e){return e.day+":"+e.hour});r.append("title"),r.enter().append("rect").attr("x",function(e){return(e.hour-1)*s}).attr("y",function(e){return(e.day-1)*s}).attr("rx",4).attr("ry",4).attr("class","hour bordered").attr("width",s).attr("height",s).style("fill",a[0]),r.transition().duration(1e3).style("fill",function(e){return n(e.value)}),r.select("title").text(function(e){return e.value}),r.exit().remove();var f=c.selectAll(".legend").data([0].concat(n.quantiles()),function(e){return e});f.enter().append("g").attr("class","legend"),f.append("rect").attr("x",function(e,t){return o*t}).attr("y",i).attr("width",o).attr("height",s/2).style("fill",function(e,t){return a[t]}),f.append("text").attr("class","mono").text(function(e){return"\u2265 "+Math.round(e)}).attr("x",function(e,t){return o*t}).attr("y",i+s),f.exit().remove()})};d(e)}function o(e,t){var n=new Date("June 2015"),r=new Date,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s='<select id = "'+t+'" class="form-control">';while(n<=r){var o=n.getMonth()==r.getMonth()&&n.getYear()==r.getYear()?'selected="selected"':"",u=i[n.getMonth()]+" "+n.getFullYear();s+="<option "+o+" value='"+e+"?month="+(n.getMonth()+1)+"&year="+n.getFullYear()+"'>"+u+"</option>",n.setMonth(n.getMonth()+1)}return s+="</select>",s}function u(e,t){var n=new Date("2015"),r=new Date,i='<select id = "'+t+'" class="form-control">';while(n<=r){var s=n.getYear()==r.getYear()?'selected="selected"':"",o=n.getFullYear();i+="<option "+s+" value='"+e+"?year="+n.getFullYear()+"'>"+o+"</option>",n.setFullYear(n.getFullYear()+1)}return i+="</select>",i}}).call(this);
